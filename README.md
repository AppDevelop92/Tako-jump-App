# Tako Jump

タコがジャンプで月を目指すモバイル向けウェブゲーム

## Play

https://appdevelop92.github.io/Tako-Jump/

## 操作方法

### PC（キーボード）

| 操作 | キー | 説明 |
|------|------|------|
| チャージ | `Space` 長押し | ジャンプ力を溜める（最大1秒） |
| ジャンプ | `Space` 離す | 溜めた力でジャンプ |
| 方向指定 | `←` `→` 矢印キー | チャージ中に押すとジャンプ方向を変更 |
| 空中微調整 | `←` `→` 矢印キー | ジャンプ中に押すと微調整 |
| ポーズ | `Esc` | ゲームを一時停止 |

**ジャンプのコツ**:
- `Space`を長く押すほど高く跳べる（最大1秒でMAX）
- チャージ中に`←`or`→`を押すと斜めにジャンプ
- 方向キーを押さないと真上にジャンプ
- 100%チャージでタコがオレンジ↔黄色に点滅

### スマホ（タッチ）

縦画面で操作します。画面下部にコントロールが表示されます。

| 操作 | 方法 |
|------|------|
| 方向指定 | 左下の方向パッドをタッチ・スライド（上方向のみ対応） |
| チャージ＆ジャンプ | 右下のジャンプボタンを長押し→離す |

**方向パッド仕様**:
- 左上・真上・右上の3方向に対応
- 下方向は入力できません（ジャンプは上方向のみのため）
- タッチしたまま指をスライドして方向を変更可能

## Architecture

```
tako-jump/
├── src/
│   ├── components/
│   │   ├── Game.tsx          # メインゲームコンポーネント（状態管理・ゲームループ）
│   │   └── MobileControls.tsx # スマホ用タッチコントロール
│   ├── game/
│   │   ├── config.ts         # 全設定値（調整はここ）
│   │   ├── types.ts          # 型定義
│   │   ├── physics.ts        # 物理演算（重力・衝突・ジャンプ）
│   │   ├── stage.ts          # ステージ生成（足場・月・星）
│   │   ├── renderer.ts       # Canvas描画
│   │   ├── storage.ts        # ハイスコア保存
│   │   └── index.ts          # エクスポート
│   ├── hooks/
│   │   ├── useGameLoop.ts    # 60fpsゲームループ
│   │   └── useKeyboardInput.ts # キーボード入力
│   └── assets/               # 画像アセット
├── docs/
│   ├── plan.md               # 開発計画
│   ├── stages.md             # ステージ設計
│   └── assets.md             # アセット仕様
└── CLAUDE.md                 # AI開発ガイドライン
```

## Assets

### タコ（プレイヤーキャラクター）

チャージ段階に応じて見た目が変化します（5段階）。

| 状態 | ファイル名 | 説明 |
|------|-----------|------|
| 通常 | `tako-0.png` | チャージ0%（デフォルト） |
| 25% | `tako-25.png` | チャージ25% |
| 50% | `tako-50.png` | チャージ50% |
| 75% | `tako-75.png` | チャージ75% |
| 100%（オレンジ） | `tako-100-orange.png` | チャージ100%（点滅用） |
| 100%（黄色） | `tako-100-yellow.png` | チャージ100%（点滅用） |
| 死亡1 | `tako-dead-0.png` | 死亡直後 |
| 死亡2 | `tako-dead-1.png` | 死亡中間 |
| 死亡3 | `tako-dead-2.png` | 死亡最終 |

### 足場

| 種類 | ファイル名 | 説明 |
|------|-----------|------|
| ノーマル | `platform_normal.png` | 着地すると停止 |
| 氷 | `platform_ice.png` | 摩擦0で滑る |
| キャタピラ | `platform_caterpillar.png` | 乗ると端まで運ばれる |
| キャタピラブロック | `caterpillar_block.png` | キャタピラの中央部分 |
| キャタピラチェーン | `caterpillar_chain.png` | キャタピラの端部分 |
| 動く足場 | `platform_moving.png` | 左右に移動する（ステージ11〜） |

### アイテム・ギミック

| 種類 | ファイル名 | 説明 |
|------|-----------|------|
| クラゲ | `jellyfish.png` | 空中ジャンプ能力を付与（ステージ11〜） |
| 水 | `water.png` | 下から迫ってくる水（シームレスタイル） |

### モバイルコントロール（使用中止・SVG描画に変更）

| 種類 | ファイル名 | 説明 |
|------|-----------|------|
| 方向パッド（通常） | `dpad_default.png` | 非アクティブ状態 |
| 方向パッド（アクティブ） | `dpad_active.png` | 方向入力中 |
| ジャンプボタン（通常） | `jump_button_default.png` | 非アクティブ状態 |
| ジャンプボタン（チャージ中） | `jump_button_charging.png` | チャージ中 |

※ 現在のモバイルコントロールはSVGで動的に描画しています

### その他（Canvas描画）

| 要素 | 色 | 説明 |
|------|-----|------|
| 背景 | `#2D2A5A` | 紺色の夜空 |
| 地面 | `#1E1B3A` | ステージ最下部の床 |
| 月 | `#FFD93D` | ゴール（黄色） |
| 星 | `#9B8AC4` | 背景装飾（薄紫） |
| うなぎ | `#FF6B6B` | スーパージャンプアイテム（薄い赤の円） |

## 用語

| 用語 | 説明 |
|------|------|
| **地面** | ステージの一番下にあるフラットな床（画面幅全体） |
| **足場** | 空中に浮いている着地できる場所（ノーマル、氷、キャタピラ、動く足場の4種類） |

## Config Reference

全ての調整可能なパラメータは `src/game/config.ts` に集約されています。

### Tako (タコ)
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `WIDTH` | 29 | タコの幅（px） |
| `HEIGHT` | 35 | タコの高さ（px） |
| `GRAVITY` | 0.35 | 重力加速度（毎フレーム） |
| `MAX_FALL_SPEED` | 10.5 | 最大落下速度 |
| `MAX_HORIZONTAL_SPEED` | 8 | 横移動速度の最大値 |
| `AIR_CONTROL` | 0.25 | 空中での横移動強度（チャージ中以外） |
| `AIR_CONTROL_CHARGING` | 0.05 | チャージ中の空中横移動強度 |

**空中操作仕様**:
- ジャンプ中（非チャージ時）: `AIR_CONTROL × HORIZONTAL_FACTOR` で横移動可能
- チャージ中: `AIR_CONTROL_CHARGING × HORIZONTAL_FACTOR` で微小な横移動のみ可能

### Jump (ジャンプ)
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `MAX_CHARGE_TIME` | 1000 | 最大チャージ時間（ms） |
| `MAX_VELOCITY` | 15.54 | 最大ジャンプ速度 |
| `MIN_VELOCITY` | 5.2 | 最小ジャンプ速度 |
| `MIN_ANGLE` | 50° | 最小ジャンプ角度 |
| `MAX_ANGLE` | 130° | 最大ジャンプ角度 |

**最大ジャンプ高さ**: 約345px（計算式: MAX_VELOCITY² / (2 × GRAVITY)）

**ジャンプ制限**:
- 地上にいる時のみジャンプ可能
- 空中ではチャージできるがジャンプは発動しない（チャージ解除のみ）
- 空中ジャンプクラゲを取得している場合、空中で1回だけジャンプ可能
- 足場から落下した場合もジャンプ不可

### Platform (足場)
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `BLOCK_SIZE` | 14 | 足場ブロックのサイズ（px） |
| `HEIGHT` | 14 | 足場の高さ（px） |

### Ice (氷の足場)
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `MAX_SLIDE_SPEED` | 6 | 氷の上での最大滑り速度 |
| `COLOR` | #87CEEB | 氷の足場の色 |

**仕様**: 摩擦0。着地時の水平速度がそのまま滑り速度になる（入射角に比例）。

### Caterpillar (キャタピラ足場)
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `SPEED` | 1.5 | キャタピラの移動速度（px/frame） |
| `COLOR_LIGHT` | #A0A0A0 | 薄い灰色 |
| `COLOR_DARK` | #606060 | 濃い灰色 |

### Moving (動く足場) ※ステージ11〜
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `DEFAULT_SPEED` | 1.5 | デフォルト移動速度 |

### Eel (スーパージャンプうなぎ)
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `SIZE` | 32 | うなぎのサイズ（px） |
| `SUPER_JUMP_VELOCITY` | 24 | スーパージャンプ速度 |
| `COLOR` | #FF6B6B | うなぎの色（薄い赤） |

### Jellyfish (空中ジャンプクラゲ) ※ステージ11〜
| パラメータ | 現在値 | 説明 |
|-----------|--------|------|
| `SIZE` | 36 | クラゲのサイズ（px） |
| `FLOAT_SPEED` | 0.003 | 浮遊アニメーション速度 |
| `FLOAT_RANGE` | 8 | 浮遊範囲（px） |

### Stage Settings (ステージ設定)
各ステージには以下の設定があります：

| パラメータ | 説明 |
|-----------|------|
| `platformCount` | 足場の数 |
| `firstPlatformGap` | **地面→最初の足場の距離**（px）※MAXジャンプ345px以下 |
| `blockCountMin/Max` | 足場のブロック数範囲（幅に影響） |
| `gapMin/Max` | **足場と足場の間の距離**（px） |
| `normalRatio` | ノーマル足場の割合（0.0〜1.0） |
| `iceRatio` | 氷の足場の割合（0.0〜1.0） |
| `caterpillarRatio` | キャタピラ足場の割合（0.0〜1.0） |
| `movingRatio` | 動く足場の割合（0.0〜1.0）※ステージ11〜 |
| `eelCount` | スーパージャンプうなぎの数 |
| `jellyfishCount` | 空中ジャンプクラゲの数 ※ステージ11〜 |
| `movingSpeed` | 動く足場の移動速度 |
| `waterSpeed` | 水の上昇速度 |
| `waterDelay` | 水が上昇し始めるまでの遅延（ms） |
| `baseTime` | 基準クリアタイム（スコア計算用） |

### 各ステージの設定値

| Stage | 足場数 | 初回Gap | ブロック数 | 間隔(px) | Normal | Ice | Caterpillar | Moving | うなぎ | クラゲ | 水速度 | 水遅延(ms) |
|-------|--------|---------|-----------|----------|--------|-----|-------------|--------|--------|--------|--------|-----------|
| 1 | 12 | 180 | 10-14 | 150-200 | 100% | 0% | 0% | 0% | 0 | 0 | 1.0 | 8000 |
| 2 | 12 | 200 | 4-8 | 220-280 | 100% | 0% | 0% | 0% | 0 | 0 | 0.8 | 6000 |
| 3 | 12 | 180 | 8-12 | 150-200 | 50% | 50% | 0% | 0% | 0 | 0 | 1.0 | 8000 |
| 4 | 12 | 220 | 4-8 | 220-280 | 30% | 70% | 0% | 0% | 0 | 0 | 1.1 | 8000 |
| 5 | 12 | 250 | 4-7 | 250-300 | 0% | 100% | 0% | 0% | 2 | 0 | 0.7 | 8000 |
| 6 | 16 | 180 | 8-12 | 150-220 | 80% | 20% | 0% | 0% | 3 | 0 | 0.8 | 6000 |
| 7 | 18 | 200 | 4-8 | 200-260 | 60% | 40% | 0% | 0% | 5 | 0 | 0.8 | 6000 |
| 8 | 14 | 200 | 6-10 | 180-250 | 40% | 40% | 20% | 0% | 2 | 0 | 0.8 | 9000 |
| 9 | 16 | 220 | 4-8 | 220-280 | 20% | 40% | 40% | 0% | 2 | 0 | 0.8 | 4000 |
| 10 | 16 | 250 | 4-7 | 250-300 | 0% | 40% | 60% | 0% | 2 | 0 | 0.8 | 3000 |
| 11 | 16 | 200 | 6-10 | 180-250 | 50% | 20% | 0% | 30% | 2 | 3 | 0.9 | 6000 |
| 12 | 18 | 220 | 5-9 | 200-280 | 30% | 30% | 10% | 30% | 3 | 4 | 0.85 | 5000 |
| 13 | 18 | 240 | 4-8 | 220-300 | 20% | 30% | 20% | 30% | 2 | 5 | 0.9 | 4500 |
| 14 | 20 | 250 | 4-7 | 240-320 | 10% | 30% | 20% | 40% | 3 | 6 | 0.95 | 4000 |
| 15 | 22 | 280 | 4-6 | 260-340 | 0% | 30% | 30% | 40% | 4 | 8 | 1.0 | 3500 |

**難易度設計**:
- 簡単（Stage 1,3,6,11）: 広い足場、間隔150-200px
- 難しい（Stage 2,4,5,7,9,10）: 狭い足場、間隔220-300px
- 上級（Stage 12-15）: 動く足場＋空中ジャンプ必須、間隔240-340px

## 足場の種類

### 1. ノーマル足場
- サーモンピンク色
- 着地すると停止する

### 2. 氷の足場
- 水色（スカイブルー）
- 摩擦0：着地時の水平速度がそのまま滑り速度になる（入射角に比例）
- 滑っている間もチャージ・ジャンプ可能

### 3. キャタピラ足場
- 灰色のベルトコンベア
- 乗るとキャタピラの方向にタコが運ばれる
- 足場の端まで運ばれると落下する

### 4. 動く足場（ステージ11〜）
- 左右に移動する足場
- 水色の矢印で移動方向を表示
- 端に到達すると反転して戻る
- 乗っているタコも一緒に移動する

## ギミック

### スーパージャンプうなぎ
- 薄い赤色の円形キャラクター
- うなぎが曲がって円を描いた形
- 空中に浮遊し、ゆっくり回転している
- **触れるとスーパージャンプ発動**（通常MAXの2倍の高さ）
- 触れると消える（同じうなぎは1回しか使えない）
- ステージリスタート時にリセットされる

### 空中ジャンプクラゲ（ステージ11〜）
- ピンク色のクラゲ
- 空中でゆらゆら浮遊している
- **触れると空中ジャンプ能力を獲得**
- 空中でチャージ→離すと空中ジャンプ発動
- 1回使うと消費される（重複取得不可）
- ステージリスタート時にリセットされる

## Tuning Guide

### 難易度を上げたい
- `gapMin/Max` を増やす（足場間距離を広げる）
- `blockCountMin/Max` を減らす（足場を狭くする）
- `waterSpeed` を上げる（追われる圧力を増やす）
- `iceRatio` / `caterpillarRatio` を上げる

### 難易度を下げたい
- `gapMin/Max` を減らす（足場間距離を縮める）
- `blockCountMin/Max` を増やす（足場を広くする）
- `waterDelay` を増やす（準備時間を増やす）
- `eelCount` を増やす（スーパージャンプを増やす）

### ジャンプ感を調整
- `GRAVITY` を減らす → 滞空時間が長くなる
- `MAX_VELOCITY` を上げる → より高く跳べる
- `HORIZONTAL_FACTOR` を調整 → 横移動距離を変更

**注意**: `gapMax` / `firstPlatformGap` は最大ジャンプ高さ（345px）を超えないようにする

## Key Mechanics

1. **シード固定ステージ**: 各ステージは番号でシード固定され、毎回同じ配置
2. **氷の足場**: 着地角度で滑り続ける（速度一定、摩擦なし）
3. **キャタピラ足場**: 乗ると端まで運ばれて落下
4. **動く足場（11〜）**: 左右に移動、乗っているタコも一緒に動く
5. **スーパージャンプうなぎ**: 触れると2倍の高さにジャンプ
6. **空中ジャンプクラゲ（11〜）**: 触れると空中ジャンプ能力を獲得
7. **ライフシステム**: 残機があれば同じステージからリスタート
8. **画面ループ**: 左右端でループ（右端→左端、左端→右端）

## Development

```bash
# 開発サーバー起動
npm run dev

# ビルド（型チェックなし、高速）
npm run build

# ビルド（型チェックあり）
npm run build:check

# 型チェックのみ
npm run typecheck

# デプロイ（gh-pagesブランチへ）
npm run build
git checkout gh-pages
rm -rf assets index.html vite.svg
cp -r dist/* .
git add -A && git commit -m "Deploy" && git push origin gh-pages
git checkout main
```

## Tech Stack

- React 18 + TypeScript
- Vite + SWC（高速ビルド）
- Canvas API（ゲーム描画）
- Tailwind CSS
