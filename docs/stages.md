# ステージ設計

## 画面サイズの基準

- 画面高さを `10` とした単位系で設計
- 実際のピクセルは実行時に計算

---

## 共通ルール

### ジャンプ性能
- 最大ジャンプ高さ: 画面の50%（= 5単位）
- 最大チャージ時間: 1.5秒
- ジャンプ角度: 45° 〜 135°

### ゴール配置
- 月は常に最上部中央
- スタートからゴールまでの総距離はステージごとに異なる

---

## ステージ別設計

### Stage 1: チュートリアル

**コンセプト**: 操作に慣れる

| 項目 | 値 |
|------|-----|
| 総高さ | 画面3枚分 |
| 床の数 | 8 |
| 床の幅 | 160px〜200px |
| 床の間隔 | 3〜4単位（余裕あり） |
| 水の上昇速度 | 0.3 px/frame |
| 水の開始遅延 | 8秒 |

**床配置イメージ**:
```
        🌙 ゴール
    ═══════════
        ═══════════
    ═══════════
        ═══════════
    ═══════════
        ═══════════
    ═══════════
        ═══════════
🐙 スタート
```

---

### Stage 2: 基本

**コンセプト**: 少し考えて飛ぶ必要がある

| 項目 | 値 |
|------|-----|
| 総高さ | 画面3.5枚分 |
| 床の数 | 7 |
| 床の幅 | 120px〜160px |
| 床の間隔 | 3.5〜4.5単位 |
| 水の上昇速度 | 0.4 px/frame |
| 水の開始遅延 | 6秒 |

---

### Stage 3: ジグザグ

**コンセプト**: 左右の移動が必要

| 項目 | 値 |
|------|-----|
| 総高さ | 画面4枚分 |
| 床の数 | 8 |
| 床の幅 | 100px〜140px |
| 床の間隔 | 4〜5単位（横にずれている） |
| 水の上昇速度 | 0.5 px/frame |
| 水の開始遅延 | 5秒 |

**床配置イメージ**:
```
                🌙
            ═══════
    ═══════
            ═══════
    ═══════
            ═══════
    ═══════
            ═══════
🐙
```

---

### Stage 4: 精密

**コンセプト**: 狭い床に正確に着地

| 項目 | 値 |
|------|-----|
| 総高さ | 画面4枚分 |
| 床の数 | 9 |
| 床の幅 | 80px〜100px |
| 床の間隔 | 4〜4.5単位 |
| 水の上昇速度 | 0.55 px/frame |
| 水の開始遅延 | 5秒 |

---

### Stage 5: 高速

**コンセプト**: 素早い判断が必要

| 項目 | 値 |
|------|-----|
| 総高さ | 画面4.5枚分 |
| 床の数 | 10 |
| 床の幅 | 100px〜120px |
| 床の間隔 | 4〜5単位 |
| 水の上昇速度 | 0.7 px/frame |
| 水の開始遅延 | 3秒 |

---

## スコア計算

### 基本式
```
ステージスコア = (基本点 + タイムボーナス) × ステージ倍率

基本点 = 1000
タイムボーナス = max(0, (基準タイム - クリアタイム) × 10)
ステージ倍率 = 1 + (ステージ番号 - 1) × 0.5
```

### 例: Stage 3 を 25秒でクリア
```
基準タイム = 40秒
タイムボーナス = (40 - 25) × 10 = 150
ステージ倍率 = 1 + (3 - 1) × 0.5 = 2.0
スコア = (1000 + 150) × 2.0 = 2300
```

---

## 床配置の生成ロジック

### 制約条件
1. 次の床までの距離 ≤ 最大ジャンプ高さ（5単位）
2. 横方向の距離も考慮（斜めジャンプの到達範囲内）
3. 床同士は重ならない
4. 画面幅内に収まる

### 擬似コード
```typescript
function generatePlatforms(config: StageConfig): Platform[] {
  const platforms: Platform[] = [];
  let currentY = START_Y;
  
  for (let i = 0; i < config.platformCount; i++) {
    const gap = randomInRange(config.minGap, config.maxGap);
    currentY += gap;
    
    const width = randomInRange(config.minWidth, config.maxWidth);
    const x = randomInRange(MARGIN, SCREEN_WIDTH - width - MARGIN);
    
    // 到達可能性チェック
    if (!isReachable(platforms[platforms.length - 1], { x, y: currentY, width })) {
      // 位置を調整
    }
    
    platforms.push({ x, y: currentY, width });
  }
  
  return platforms;
}
```

---

## 調整メモ

### 水の速度（★要プレイテスト）
初期値は控えめに設定。実際にプレイして以下を確認：
- 焦らずに進めるか（易しすぎないか）
- 理不尽に感じないか（難しすぎないか）
- 緊張感があるか

### 床の幅
狭すぎると着地が難しくストレス。広すぎると単調。
目安: タコの幅（32px）の3〜6倍

### 床の間隔
最大ジャンプ（5単位）より少し短めが基本。
MAXチャージ必須の配置は連続させない。
