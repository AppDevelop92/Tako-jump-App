# 開発計画 - Tako Jump

## 全体像

```
Phase 1: 基盤構築        → プロジェクト設定、ゲームループ、タコの表示
Phase 2: コア操作        → チャージ＆ジャンプ、床と衝突判定
Phase 3: ゲームシステム  → 水、ゴール、ライフ、スコア
Phase 4: UI/画面遷移     → クリア画面、ゲームオーバー、HUD
Phase 5: ビジュアル強化  → アニメーション、背景、エフェクト
Phase 6: ステージ＆調整  → 複数ステージ、バランス調整
Phase 7: 最終確認        → デザイン・アーキテクチャ・UXレビュー
```

---

## Phase 1: 基盤構築

### 目標
ゲームの土台を作り、タコが画面に表示されて落下する状態まで

### タスク
1. Vite + React + TypeScript プロジェクト作成
2. Tailwind CSS 設定
3. ディレクトリ構造の作成
4. `config.ts` に基本パラメータ定義
5. `types.ts` に型定義
6. Canvas コンポーネント作成
7. ゲームループ実装（requestAnimationFrame）
8. タコエンティティ作成（四角形で仮表示）
9. 重力による落下実装
10. 地面との衝突（画面下で停止）

### 完了条件
- [x] `npm run dev` でゲームが起動
- [x] タコ（仮の四角形）が表示され、重力で落下
- [x] 画面下で停止する

---

## Phase 2: コア操作

### 目標
タップ＆ホールドでチャージし、方向を指定してジャンプできる

### タスク
1. コントロールパッド UI 作成
2. タッチイベント処理（touchstart/move/end）
3. チャージ時間の計測
4. 方向ベクトルの計算
5. ジャンプ物理演算（初速度、角度から軌道計算）
6. 床エンティティ作成
7. 床との衝突判定（上から乗る）
8. 着地判定とジャンプ可能状態の管理
9. 空中での微調整（わずかな左右移動）
10. カメラ追従（タコを画面中央付近に）

### 完了条件
- [x] タップ長押しでチャージ
- [x] スワイプ方向にジャンプ
- [x] 床に着地できる
- [x] 空中では微調整のみ可能

### 技術メモ
```typescript
// ジャンプ計算の基本式
const chargeRatio = chargeTime / MAX_CHARGE_TIME; // 0〜1
const jumpPower = chargeRatio * MAX_JUMP_VELOCITY;
const vx = jumpPower * Math.cos(angle);
const vy = jumpPower * Math.sin(angle); // 上向きが負
```

---

## Phase 3: ゲームシステム

### 目標
ゲームとして成立する状態（勝ち負けがある）

### タスク
1. 月（ゴール）エンティティ作成
2. ゴール判定（月との衝突）
3. 水エンティティ作成（上昇する）
4. 水との衝突判定
5. ライフシステム実装
6. ステージクリア処理
7. ゲームオーバー処理
8. スコア計算ロジック
9. ハイスコアのlocalStorage保存
10. ステージリセット処理

### 完了条件
- [x] 月に触れるとステージクリア
- [x] 水に触れるとライフ-1
- [x] ライフ0でゲームオーバー
- [x] スコアが計算・保存される

---

## Phase 4: UI/画面遷移

### 目標
ゲームとしての体裁を整える

### タスク
1. ゲーム状態管理（title/playing/cleared/gameover）
2. タイトル画面
3. HUD（スコア、ステージ、ライフ表示）
4. ステージクリア画面
5. ゲームオーバー画面
6. ハイスコア更新表示（点滅）
7. 画面遷移アニメーション
8. タップで次へ進む処理

### 完了条件
- [x] 全画面が実装されている
- [x] 画面遷移がスムーズ
- [x] ハイスコア更新が視覚的にわかる

---

## Phase 5: ビジュアル強化

### 目標
見た目を参考画像に近づける

### タスク
1. タコのスプライト作成（Canvas描画）
2. チャージ状態による色変化（白→ピンク→赤）
3. チャージ状態による目の変化
4. 死亡モーション
5. 床のタイル描画
6. 月の描画
7. 背景（星、装飾月）
8. パララックス効果
9. 水の波アニメーション
10. チャージインジケーター（視覚的フィードバック）

### 完了条件
- [x] タコのアニメーションが滑らか
- [x] 背景が宇宙らしい
- [x] 全体的に参考画像の雰囲気

---

## Phase 6: ステージ＆調整

### 目標
複数ステージでゲームバランスを整える

### タスク
1. ステージ生成ロジック
2. 難易度曲線の設計
3. 床の配置パターン
4. 水の上昇速度調整
5. スコアバランス調整
6. ステージ3〜5の実装
7. プレイテストと調整
8. パラメータのファインチューニング

### 完了条件
- [x] 最低5ステージが遊べる
- [x] 難易度が適切に上昇
- [x] クリア可能だがやりごたえがある

---

## Phase 7: 最終確認（レビューフェーズ）

### 目標
品質保証と最終調整

### チェックリスト

#### デザインレビュー
- [x] 色使いは統一されているか
- [x] ピクセルアート風の一貫性があるか
- [x] UIの視認性は十分か
- [x] アニメーションは滑らかか

#### アーキテクチャレビュー
- [x] 関心の分離ができているか
- [x] config.tsにパラメータが集約されているか
- [x] 型定義は適切か
- [x] 重複コードはないか
- [x] 各関数は単一責任か

#### UXレビュー
- [x] 操作は直感的か
- [x] フィードバックは十分か（チャージ中の視覚表示など）
- [x] ロード時間は許容範囲か
- [x] エラー時の挙動は適切か

---

## 実行方法

各フェーズの開始時に以下を指示：

```
CLAUDE.mdとdocs/plan.mdを読み、Phase X を実行してください。
完了したらdocs/plan.mdの該当タスクにチェックを入れてください。
```

最終フェーズ（Phase 7）では：

```
CLAUDE.mdとdocs/plan.mdを読み、Phase 7のレビューを実行してください。
各チェック項目を確認し、問題があれば修正してください。
```

---

## 備考

### 水の上昇速度（要調整）
実際にプレイしてから調整する。初期値：
- Stage 1: 0.3 px/frame
- Stage 2: 0.5 px/frame
- Stage 3: 0.7 px/frame

### 実験ブランチ運用
- 新機能は `experiment/feature-name` ブランチで試す
- 知見がまとまったら `main` に一発で反映
- 修正の繰り返しは避ける
